package com.kh.demo.member.model.service;

import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;

import com.kh.demo.exception.IdDuplicateException;
import com.kh.demo.member.model.dao.MemberMapper;
import com.kh.demo.member.model.dto.MemberDTO;
import com.kh.demo.member.model.vo.MemberVO;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class MemberServiceImpl implements MemberService {

	private final MemberMapper memberMapper;
	private final BCryptPasswordEncoder passwordEncoder;
	
	@Override
	public void signUp(MemberDTO member) {

		// 유효성검사 +
		// 아이디 중복 검사
		int count =  memberMapper.countByMemberId(member.getMemberId());
		
		if(1 == count) {
			throw new IdDuplicateException("이미 존재하는 아이디입니다.");
		}
		
		
		// 비밀번호 암호화
//		String encodedPwd = passwordEncoder.encode(member.getMemberPwd());
		
		// ROLE주기
		MemberVO memberBuilder = MemberVO.builder()
										 .memberId(member.getMemberId())
										 .memberPwd(passwordEncoder.encode(member.getMemberPwd()))
										 .memberName(member.getMemberName())
										 .role("ROLE_USER")
										 .build()
;		
		// 매퍼 호출

	}

}
